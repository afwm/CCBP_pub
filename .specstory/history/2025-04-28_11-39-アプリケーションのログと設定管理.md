<!-- Generated by SpecStory -->

# アプリケーションのログと設定管理 (2025-04-28 20:39:52)

_**User**_

ログ
2025-04-28 20:28:43,020 - ccbp - INFO - logging_config:79 - Logging setup complete. Logging to console and potentially /Users/mbp/Library/Logs/CCBP/app.log (daily rotation, keep 7 days)
2025-04-28 20:28:43,021 - ccbp - INFO - main:43 - Loaded environment variables from: .env
2025-04-28 20:28:43,352 - ccbp.core.config_manager - INFO - config_manager:177 - Using config directory: /Users/mbp/Library/Application Support/CCBP
2025-04-28 20:28:43,352 - ccbp.core.config_manager - INFO - config_manager:223 - /Users/mbp/Library/Application Support/CCBP/config.json not found. Using default configuration.
2025-04-28 20:28:43,352 - ccbp.core.config_manager - INFO - config_manager:140 - Generating new internal Fernet key and initializing instance...
2025-04-28 20:28:43,352 - ccbp.core.config_manager - DEBUG - config_manager:144 - [DEBUG] Generated key (base64 bytes, should be 44): b'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:28:43,352 - ccbp.core.config_manager - INFO - config_manager:146 - Internal Fernet instance initialized successfully with newly generated key.
2025-04-28 20:28:43,352 - ccbp.core.config_manager - DEBUG - config_manager:150 - [DEBUG] Key string to save (should be 44 chars): 'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:28:43,352 - ccbp.core.config_manager - DEBUG - config_manager:156 - [DEBUG] Key string in self.config before save: 'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac='
2025-04-28 20:28:43,353 - ccbp.core.config_manager - INFO - config_manager:157 - Attempting to save new base64 key string to config key 'internal/fernet_key'...
2025-04-28 20:28:43,353 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:28:43,353 - ccbp.core.config_manager - INFO - config_manager:161 - New internal Fernet key generated and saved to config.json.
2025-04-28 20:28:43,353 - ccbp.core.license_manager - INFO - license_manager:37 - License validation API URL configured: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:28:43,353 - ccbp.core.license_manager - INFO - license_manager:40 - LICENSE_SECRET_KEY found and will be used for validation requests.
2025-04-28 20:28:43,353 - ccbp.core.license_manager - INFO - license_manager:45 - LicenseManager initialized.
2025-04-28 20:28:43,353 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'system.install_date': 2025-04-28T11:28:43.353695+00:00}
2025-04-28 20:28:43,353 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'system.last_valid_date': 2025-04-28T11:28:43.353695+00:00}
2025-04-28 20:28:43,354 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:28:43,354 - ccbp.core.license_manager - INFO - license_manager:265 - 新規インストール日を記録: 2025-04-28T11:28:43.353695+00:00
2025-04-28 20:28:43,354 - ccbp.core.batch_controller - INFO - batch_controller:33 - BatchController initialized
2025-04-28 20:28:43,354 - ccbp.core.crop_controller - INFO - crop_controller:623 - Searching for ffmpeg/ffprobe in expected assets path: /Users/mbp/Public/dev/personal/CapCut/CCBP/ccbp/assets/ffmpeg
2025-04-28 20:28:43,355 - ccbp.core.crop_controller - WARNING - crop_controller:642 - ffmpeg not found in assets. Trying PATH.
2025-04-28 20:28:43,355 - ccbp.core.crop_controller - INFO - crop_controller:646 - Found ffmpeg in PATH: /opt/homebrew/bin/ffmpeg
2025-04-28 20:28:43,355 - ccbp.core.crop_controller - WARNING - crop_controller:651 - ffprobe not found in assets. Trying PATH.
2025-04-28 20:28:43,355 - ccbp.core.crop_controller - INFO - crop_controller:655 - Found ffprobe in PATH: /opt/homebrew/bin/ffprobe
2025-04-28 20:28:43,355 - ccbp.core.crop_controller - INFO - crop_controller:70 - CropController initialized. FFmpeg: /opt/homebrew/bin/ffmpeg, FFprobe: /opt/homebrew/bin/ffprobe
2025-04-28 20:28:43,355 - ccbp.core.settings_controller - INFO - settings_controller:57 - SettingsController initialized (synchronous validation mode).
2025-04-28 20:28:43,613 - ccbp.core.batch_controller - INFO - batch_controller:50 - Initializing batch controller connections
2025-04-28 20:28:43,613 - ccbp.core.batch_controller - INFO - batch_controller:120 - Batch view signals connected.
2025-04-28 20:28:43,613 - ccbp.core.batch_controller - INFO - batch_controller:126 - Loading batch paths from config...
2025-04-28 20:28:43,613 - ccbp.core.batch_controller - INFO - batch_controller:138 - Successfully loaded batch paths into view.
2025-04-28 20:28:43,613 - ccbp.core.crop_controller - INFO - crop_controller:521 - CropController view has been set.
2025-04-28 20:28:43,613 - ccbp.core.crop_controller - INFO - crop_controller:576 - Loaded paths from config: Input='', Output=''
2025-04-28 20:28:43,613 - ccbp.core.crop_controller - INFO - crop_controller:555 - Crop view signals connected.
2025-04-28 20:28:43,613 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x13a82fbf0) at 0x10f1a7780>
2025-04-28 20:28:43,614 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:28:43,614 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:28:43,614 - ccbp.ui.settings_tab - INFO - settings_tab:168 - Settings loaded into view (excluding license key and crop defaults). Call set_license_status separately.
2025-04-28 20:28:43,614 - ccbp.core.settings_controller - INFO - settings_controller:82 - Loading cached license status...
2025-04-28 20:28:43,614 - ccbp.core.config_manager - WARNING - config_manager:251 - Value for encrypted key 'license_key' is not a valid string (''). Returning default.
2025-04-28 20:28:43,614 - ccbp.core.config_manager - WARNING - config_manager:251 - Value for encrypted key 'license_key' is not a valid string (''). Returning default.
2025-04-28 20:28:43,614 - ccbp.core.settings_controller - INFO - settings_controller:89 - Displayed cached license status: 未入力 (Valid: None)
2025-04-28 20:28:43,614 - ccbp.core.settings_controller - INFO - settings_controller:99 - SettingsController view has been set and initial settings loaded.
2025-04-28 20:28:43,615 - ccbp.core.settings_controller - DEBUG - settings_controller:62 - Setting references to Batch and Crop controllers.
2025-04-28 20:28:43,615 - ccbp.ui.crop_tab - INFO - crop_tab:40 - CropTabView controller set and signals connected.
2025-04-28 20:28:43,615 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x13a82fbf0) at 0x10f1a7780>
2025-04-28 20:28:43,615 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:28:43,615 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:28:43,615 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'system.last_valid_date': 2025-04-28T11:28:43.615220+00:00}
2025-04-28 20:28:43,615 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:28:43,615 - ccbp.core.config_manager - WARNING - config_manager:251 - Value for encrypted key 'license_key' is not a valid string (''). Returning default.
2025-04-28 20:28:43,615 - ccbp - INFO - main:125 - Startup trial status: {'in_trial': True, 'days_left': 14, 'install_date': '2025-04-28T11:28:43.353695+00:00', 'restricted': False, 'tampered': False}
2025-04-28 20:28:45,884 - ccbp.core.batch_controller - WARNING - batch_controller:584 - Attempted to save empty path for required key batch/csv_file. Reverting.
2025-04-28 20:28:51,017 - ccbp.core.settings_controller - INFO - settings_controller:415 - Triggering license validation ASYNCHRONOUSLY for key: 'WG54d...'
2025-04-28 20:28:51,018 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:28:51,018 - ccbp.core.settings_controller - DEBUG - settings_controller:440 - Emitting authentication_started signal (async)
2025-04-28 20:28:51,359 - ccbp.core.workers.license_worker - DEBUG - license_worker:32 - [START] LicenseWorker.run for key: 'WG54d...'
2025-04-28 20:28:51,359 - ccbp.core.workers.license_worker - INFO - license_worker:39 - LicenseWorker: Starting validation for key 'WG54d...'
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:60 - API Key added to request headers.
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:65 - Sending license validation request:
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:66 -   URL: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:67 -   Method: GET
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:68 -   Headers: {'Authorization': 'Bearer CbVn7P73enT9ZqZDM42MKRrDqQgUDZX3T3YkySZ4zgihHRYYXQxEtExxTtkC3qEgqyR7Ah23jreA4DhiJTT4cnAooG6ewFfYoXrHYq47EzbvK2mvmKNT8jx4KDqCNxwK'}
2025-04-28 20:28:51,360 - ccbp.core.license_manager - DEBUG - license_manager:69 -   Params: {'action': 'verify', 'key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB'}
2025-04-28 20:28:57,084 - ccbp.core.license_manager - DEBUG - license_manager:71 - API Response Status Code: 200
2025-04-28 20:28:57,084 - ccbp.core.license_manager - DEBUG - license_manager:72 - API Response Headers: {'Content-Type': 'application/json; charset=utf-8', 'Vary': 'Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site', 'X-Content-Type-Options': 'nosniff', 'Access-Control-Allow-Origin': '*', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': 'Mon, 01 Jan 1990 00:00:00 GMT', 'Date': 'Mon, 28 Apr 2025 11:28:56 GMT', 'Content-Encoding': 'gzip', 'X-Frame-Options': 'SAMEORIGIN', 'Content-Security-Policy': "frame-ancestors 'self'", 'X-XSS-Protection': '1; mode=block', 'Server': 'GSE', 'Alt-Svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000', 'Transfer-Encoding': 'chunked'}
2025-04-28 20:28:57,085 - ccbp.core.license_manager - DEBUG - license_manager:77 - API Response Body: {'license_key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB', 'expires': '0000-00-00', 'persistent_signature': 'feAs77FEmOF+IB3D0qAr0ACO6OGeudL0TUB2HodIsZo=', 'created_at': '2025-04-18 17:13:22', 'checked_at': '2025-04-28 20:28:52', 'status': 'active', 'response_timestamp': '2025-04-28T11:28:52.387Z', 'response_signature': '4052cf48479814cb88e69f0dc9d3f89aac146229d60f2b8f07d263ecb19eb67d'}
2025-04-28 20:28:57,099 - ccbp.core.config_manager - DEBUG - config_manager:291 - Encrypted value set for key 'license_key'
2025-04-28 20:28:57,099 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.status': active}
2025-04-28 20:28:57,100 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.expires': 0000-00-00}
2025-04-28 20:28:57,100 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.validated_at': 2025-04-28T11:28:57.085080+00:00}
2025-04-28 20:28:57,100 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.last_message': 有効 (無期限ライセンス)}
2025-04-28 20:28:57,100 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:28:57,101 - ccbp.core.license_manager - INFO - license_manager:155 - License cache updated: Key=WG54d..., Status=active, Expires=0000-00-00, ValidatedAt=2025-04-28T11:28:57.085080+00:00, Message=有効 (無期限ライセンス)
2025-04-28 20:28:57,101 - ccbp.core.workers.license_worker - INFO - license_worker:53 - LicenseWorker: Validation successful.
2025-04-28 20:28:57,101 - ccbp.core.workers.license_worker - DEBUG - license_worker:54 - Emitting finished signal with result: {'license_key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB', 'expires': '0000-00-00', 'persistent_signature': 'feAs77FEmOF+IB3D0qAr0ACO6OGeudL0TUB2HodIsZo=', 'created_at': '2025-04-18 17:13:22', 'checked_at': '2025-04-28 20:28:52', 'status': 'active', 'response_timestamp': '2025-04-28T11:28:52.387Z', 'response_signature': '4052cf48479814cb88e69f0dc9d3f89aac146229d60f2b8f07d263ecb19eb67d'}
2025-04-28 20:28:57,102 - ccbp.core.workers.license_worker - DEBUG - license_worker:74 - [END] LicenseWorker.run
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - INFO - settings_controller:451 - LicenseWorker finished signal received. Result data: {'license_key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB', 'expires': '0000-00-00', 'persistent_signature': 'feAs77FEmOF+IB3D0qAr0ACO6OGeudL0TUB2HodIsZo=', 'created_at': '2025-04-18 17:13:22', 'checked_at': '2025-04-28 20:28:52', 'status': 'active', 'response_timestamp': '2025-04-28T11:28:52.387Z', 'response_signature': '4052cf48479814cb88e69f0dc9d3f89aac146229d60f2b8f07d263ecb19eb67d'}
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - DEBUG - settings_controller:535 - [START] _update_view_with_validation_result for key 'WG54d...'
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - DEBUG - settings_controller:541 - Updating view for license key: 'WG54d...'
2025-04-28 20:28:57,102 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - DEBUG - settings_controller:555 - Using cached status after worker: 有効 (無期限ライセンス) (@2025-04-28 20:28:57), is_valid: True
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - DEBUG - settings_controller:560 - Determined display_text: 'WG54*...'
2025-04-28 20:28:57,102 - ccbp.core.settings_controller - DEBUG - settings_controller:564 - Calling view.set_license_entry_state with is_valid=True, status=有効 (無期限ライセンス) (@2025-04-28 20:28:57)
2025-04-28 20:28:57,103 - ccbp.core.settings_controller - INFO - settings_controller:570 - License status updated in view: 有効 (無期限ライセンス) (@2025-04-28 20:28:57) (Valid: True)
2025-04-28 20:28:57,103 - ccbp.core.settings_controller - DEBUG - settings_controller:580 - [END] _update_view_with_validation_result
2025-04-28 20:28:57,103 - ccbp.core.settings_controller - DEBUG - settings_controller:466 - Emitting authentication_finished signal (async success) with message: '有効 (無期限ライセンス)', success: True
2025-04-28 20:28:57,420 - ccbp.core.settings_controller - DEBUG - settings_controller:529 - Clearing license worker and thread references.
2025-04-28 20:29:00,406 - ccbp.core.settings_controller - INFO - settings_controller:584 - Finalizing SettingsController.
2025-04-28 20:29:00,406 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:29:00,407 - ccbp.core.settings_controller - INFO - settings_controller:594 - SettingsController finalized
2025-04-28 20:29:00,418 - ccbp - INFO - main:151 - Application exiting. Saving configuration...
2025-04-28 20:29:00,419 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:29:00,419 - ccbp - INFO - main:156 - Configuration saved.
2025-04-28 20:29:05,126 - ccbp - INFO - logging_config:79 - Logging setup complete. Logging to console and potentially /Users/mbp/Library/Logs/CCBP/app.log (daily rotation, keep 7 days)
2025-04-28 20:29:05,126 - ccbp - INFO - main:43 - Loaded environment variables from: .env
2025-04-28 20:29:05,335 - ccbp.core.config_manager - INFO - config_manager:177 - Using config directory: /Users/mbp/Library/Application Support/CCBP
2025-04-28 20:29:05,335 - ccbp.core.config_manager - INFO - config_manager:215 - Configuration loaded from /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:29:05,335 - ccbp.core.config_manager - DEBUG - config_manager:117 - Attempting to load internal Fernet key from config key: internal/fernet_key
2025-04-28 20:29:05,335 - ccbp.core.config_manager - DEBUG - config_manager:119 - [DEBUG] key_str_b64_stripped from file: 'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:29:05,335 - ccbp.core.config_manager - DEBUG - config_manager:125 - [DEBUG] key_b64_bytes_for_fernet (should be 44 bytes): b'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:29:05,335 - ccbp.core.config_manager - INFO - config_manager:129 - Internal Fernet instance initialized successfully using key from config.
2025-04-28 20:29:05,335 - ccbp.core.license_manager - INFO - license_manager:37 - License validation API URL configured: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:29:05,335 - ccbp.core.license_manager - INFO - license_manager:40 - LICENSE_SECRET_KEY found and will be used for validation requests.
2025-04-28 20:29:05,335 - ccbp.core.license_manager - INFO - license_manager:45 - LicenseManager initialized.
2025-04-28 20:29:05,335 - ccbp.core.batch_controller - INFO - batch_controller:33 - BatchController initialized
2025-04-28 20:29:05,335 - ccbp.core.crop_controller - INFO - crop_controller:623 - Searching for ffmpeg/ffprobe in expected assets path: /Users/mbp/Public/dev/personal/CapCut/CCBP/ccbp/assets/ffmpeg
2025-04-28 20:29:05,335 - ccbp.core.crop_controller - WARNING - crop_controller:642 - ffmpeg not found in assets. Trying PATH.
2025-04-28 20:29:05,336 - ccbp.core.crop_controller - INFO - crop_controller:646 - Found ffmpeg in PATH: /opt/homebrew/bin/ffmpeg
2025-04-28 20:29:05,336 - ccbp.core.crop_controller - WARNING - crop_controller:651 - ffprobe not found in assets. Trying PATH.
2025-04-28 20:29:05,336 - ccbp.core.crop_controller - INFO - crop_controller:655 - Found ffprobe in PATH: /opt/homebrew/bin/ffprobe
2025-04-28 20:29:05,336 - ccbp.core.crop_controller - INFO - crop_controller:70 - CropController initialized. FFmpeg: /opt/homebrew/bin/ffmpeg, FFprobe: /opt/homebrew/bin/ffprobe
2025-04-28 20:29:05,336 - ccbp.core.settings_controller - INFO - settings_controller:57 - SettingsController initialized (synchronous validation mode).
2025-04-28 20:29:05,542 - ccbp.core.batch_controller - INFO - batch_controller:50 - Initializing batch controller connections
2025-04-28 20:29:05,542 - ccbp.core.batch_controller - INFO - batch_controller:120 - Batch view signals connected.
2025-04-28 20:29:05,542 - ccbp.core.batch_controller - INFO - batch_controller:126 - Loading batch paths from config...
2025-04-28 20:29:05,543 - ccbp.core.batch_controller - INFO - batch_controller:138 - Successfully loaded batch paths into view.
2025-04-28 20:29:05,543 - ccbp.core.crop_controller - INFO - crop_controller:521 - CropController view has been set.
2025-04-28 20:29:05,543 - ccbp.core.crop_controller - INFO - crop_controller:576 - Loaded paths from config: Input='', Output=''
2025-04-28 20:29:05,543 - ccbp.core.crop_controller - INFO - crop_controller:555 - Crop view signals connected.
2025-04-28 20:29:05,543 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x11ff1fa20) at 0x10d697740>
2025-04-28 20:29:05,544 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:29:05,544 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:29:05,544 - ccbp.ui.settings_tab - INFO - settings_tab:168 - Settings loaded into view (excluding license key and crop defaults). Call set_license_status separately.
2025-04-28 20:29:05,544 - ccbp.core.settings_controller - INFO - settings_controller:82 - Loading cached license status...
2025-04-28 20:29:05,546 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:29:05,546 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:29:05,547 - ccbp.core.settings_controller - INFO - settings_controller:89 - Displayed cached license status: 有効 (無期限ライセンス) (@2025-04-28 20:28:57) (Valid: True)
2025-04-28 20:29:05,547 - ccbp.core.settings_controller - INFO - settings_controller:99 - SettingsController view has been set and initial settings loaded.
2025-04-28 20:29:05,547 - ccbp.core.settings_controller - DEBUG - settings_controller:62 - Setting references to Batch and Crop controllers.
2025-04-28 20:29:05,547 - ccbp.ui.crop_tab - INFO - crop_tab:40 - CropTabView controller set and signals connected.
2025-04-28 20:29:05,547 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x11ff1fa20) at 0x10d697740>
2025-04-28 20:29:05,547 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:29:05,547 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:29:05,547 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'system.last_valid_date': 2025-04-28T11:29:05.547560+00:00}
2025-04-28 20:29:05,548 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:29:05,548 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:29:05,548 - ccbp - INFO - main:125 - Startup trial status: {'in_trial': True, 'days_left': 14, 'install_date': '2025-04-28T11:28:43.353695+00:00', 'restricted': False, 'tampered': False}
2025-04-28 20:29:08,369 - ccbp.core.batch_controller - WARNING - batch_controller:584 - Attempted to save empty path for required key batch/csv_file. Reverting.
2025-04-28 20:29:13,170 - ccbp.core.settings_controller - INFO - settings_controller:584 - Finalizing SettingsController.
2025-04-28 20:29:13,170 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:29:13,170 - ccbp.core.settings_controller - INFO - settings_controller:594 - SettingsController finalized
2025-04-28 20:29:13,216 - ccbp - INFO - main:151 - Application exiting. Saving configuration...
2025-04-28 20:29:13,217 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:29:13,217 - ccbp - INFO - main:156 - Configuration saved.
2025-04-28 20:33:07,915 - ccbp - INFO - logging_config:79 - Logging setup complete. Logging to console and potentially /Users/mbp/Library/Logs/CCBP/app.log (daily rotation, keep 7 days)
2025-04-28 20:33:07,916 - ccbp - INFO - main:43 - Loaded environment variables from: .env
2025-04-28 20:33:08,259 - ccbp.core.config_manager - INFO - config_manager:177 - Using config directory: /Users/mbp/Library/Application Support/CCBP
2025-04-28 20:33:08,260 - ccbp.core.config_manager - INFO - config_manager:215 - Configuration loaded from /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:33:08,260 - ccbp.core.config_manager - DEBUG - config_manager:117 - Attempting to load internal Fernet key from config key: internal/fernet_key
2025-04-28 20:33:08,260 - ccbp.core.config_manager - DEBUG - config_manager:119 - [DEBUG] key_str_b64_stripped from file: 'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:33:08,260 - ccbp.core.config_manager - DEBUG - config_manager:125 - [DEBUG] key_b64_bytes_for_fernet (should be 44 bytes): b'afUm-UkeG7QolKGJ1oEqeOjzBLTz-xawJGaAK0sC7ac=' (len: 44)
2025-04-28 20:33:08,260 - ccbp.core.config_manager - INFO - config_manager:129 - Internal Fernet instance initialized successfully using key from config.
2025-04-28 20:33:08,260 - ccbp.core.license_manager - INFO - license_manager:37 - License validation API URL configured: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:33:08,260 - ccbp.core.license_manager - INFO - license_manager:40 - LICENSE_SECRET_KEY found and will be used for validation requests.
2025-04-28 20:33:08,260 - ccbp.core.license_manager - INFO - license_manager:45 - LicenseManager initialized.
2025-04-28 20:33:08,260 - ccbp.core.batch_controller - INFO - batch_controller:33 - BatchController initialized
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - INFO - crop_controller:623 - Searching for ffmpeg/ffprobe in expected assets path: /Users/mbp/Public/dev/personal/CapCut/CCBP/ccbp/assets/ffmpeg
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - WARNING - crop_controller:642 - ffmpeg not found in assets. Trying PATH.
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - INFO - crop_controller:646 - Found ffmpeg in PATH: /opt/homebrew/bin/ffmpeg
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - WARNING - crop_controller:651 - ffprobe not found in assets. Trying PATH.
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - INFO - crop_controller:655 - Found ffprobe in PATH: /opt/homebrew/bin/ffprobe
2025-04-28 20:33:08,261 - ccbp.core.crop_controller - INFO - crop_controller:70 - CropController initialized. FFmpeg: /opt/homebrew/bin/ffmpeg, FFprobe: /opt/homebrew/bin/ffprobe
2025-04-28 20:33:08,261 - ccbp.core.settings_controller - INFO - settings_controller:57 - SettingsController initialized (synchronous validation mode).
2025-04-28 20:33:08,515 - ccbp.core.batch_controller - INFO - batch_controller:50 - Initializing batch controller connections
2025-04-28 20:33:08,516 - ccbp.core.batch_controller - INFO - batch_controller:120 - Batch view signals connected.
2025-04-28 20:33:08,516 - ccbp.core.batch_controller - INFO - batch_controller:126 - Loading batch paths from config...
2025-04-28 20:33:08,516 - ccbp.core.batch_controller - INFO - batch_controller:138 - Successfully loaded batch paths into view.
2025-04-28 20:33:08,516 - ccbp.core.crop_controller - INFO - crop_controller:521 - CropController view has been set.
2025-04-28 20:33:08,516 - ccbp.core.crop_controller - INFO - crop_controller:576 - Loaded paths from config: Input='', Output=''
2025-04-28 20:33:08,516 - ccbp.core.crop_controller - INFO - crop_controller:555 - Crop view signals connected.
2025-04-28 20:33:08,516 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x10cf67870) at 0x10c897700>
2025-04-28 20:33:08,517 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:33:08,517 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:33:08,518 - ccbp.ui.settings_tab - INFO - settings_tab:168 - Settings loaded into view (excluding license key and crop defaults). Call set_license_status separately.
2025-04-28 20:33:08,518 - ccbp.core.settings_controller - INFO - settings_controller:82 - Loading cached license status...
2025-04-28 20:33:08,525 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:33:08,525 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:33:08,526 - ccbp.core.settings_controller - INFO - settings_controller:89 - Displayed cached license status: 有効 (無期限ライセンス) (@2025-04-28 20:28:57) (Valid: True)
2025-04-28 20:33:08,526 - ccbp.core.settings_controller - INFO - settings_controller:99 - SettingsController view has been set and initial settings loaded.
2025-04-28 20:33:08,526 - ccbp.core.settings_controller - DEBUG - settings_controller:62 - Setting references to Batch and Crop controllers.
2025-04-28 20:33:08,526 - ccbp.ui.crop_tab - INFO - crop_tab:40 - CropTabView controller set and signals connected.
2025-04-28 20:33:08,526 - ccbp.ui.settings_tab - DEBUG - settings_tab:106 - _connect_signals called for <ccbp.ui.settings_tab.SettingsTabView(0x10cf67870) at 0x10c897700>
2025-04-28 20:33:08,526 - ccbp.ui.settings_tab - DEBUG - settings_tab:122 - Attempted to disconnect existing signals before reconnecting.
2025-04-28 20:33:08,526 - ccbp.ui.settings_tab - INFO - settings_tab:142 - Settings view signals connected.
2025-04-28 20:33:08,526 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'system.last_valid_date': 2025-04-28T11:33:08.526633+00:00}
2025-04-28 20:33:08,527 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:33:08,527 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:33:08,527 - ccbp - INFO - main:125 - Startup trial status: {'in_trial': True, 'days_left': 14, 'install_date': '2025-04-28T11:28:43.353695+00:00', 'restricted': False, 'tampered': False}
2025-04-28 20:33:11,261 - ccbp.core.batch_controller - WARNING - batch_controller:584 - Attempted to save empty path for required key batch/csv_file. Reverting.
2025-04-28 20:33:17,573 - ccbp.core.settings_controller - INFO - settings_controller:584 - Finalizing SettingsController.
2025-04-28 20:33:17,574 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:33:17,574 - ccbp.core.settings_controller - INFO - settings_controller:594 - SettingsController finalized
2025-04-28 20:33:24,977 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'working_directory': /Users/mbp/Movies/CapCut/CCBP_WorkSpace}
2025-04-28 20:33:24,979 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:33:24,979 - ccbp.core.settings_controller - INFO - settings_controller:135 - Working directory selected and saved: /Users/mbp/Movies/CapCut/CCBP_WorkSpace
2025-04-28 20:33:30,713 - ccbp.core.settings_controller - INFO - settings_controller:584 - Finalizing SettingsController.
2025-04-28 20:33:30,713 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:33:30,713 - ccbp.core.settings_controller - INFO - settings_controller:594 - SettingsController finalized
2025-04-28 20:33:31,938 - ccbp.core.crop_controller - DEBUG - crop_controller:586 - Browsing for input folder, starting from: 
2025-04-28 20:33:53,989 - ccbp.core.crop_controller - INFO - crop_controller:589 - Input folder selected: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput
2025-04-28 20:33:53,991 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'crop_input_dir': /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput}
2025-04-28 20:33:53,993 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:33:54,707 - ccbp.core.crop_controller - DEBUG - crop_controller:604 - Browsing for output folder, starting from: 
2025-04-28 20:33:57,367 - ccbp.core.crop_controller - INFO - crop_controller:607 - Output folder selected: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput
2025-04-28 20:33:57,368 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'crop_output_dir': /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput}
2025-04-28 20:33:57,368 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:02,640 - ccbp.core.crop_controller - INFO - crop_controller:73 - Generate preview requested.
2025-04-28 20:34:02,642 - ccbp.core.crop_controller - INFO - crop_controller:97 - Preview generation paths: {'input': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput', 'output': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput'}
2025-04-28 20:34:02,642 - ccbp.core.crop_controller - DEBUG - crop_controller:110 - Setting UI state for preview generation.
2025-04-28 20:34:02,657 - ccbp.core.crop_controller - INFO - crop_controller:116 - Preparing PreviewWorker thread.
2025-04-28 20:34:02,658 - ccbp.core.crop_controller - DEBUG - crop_controller:340 - --- cleanup_workers requested ---
2025-04-28 20:34:02,658 - ccbp.core.crop_controller - DEBUG - crop_controller:343 - Checking preview thread. Instance: None, Running: N/A
2025-04-28 20:34:02,658 - ccbp.core.crop_controller - DEBUG - crop_controller:377 - Checking crop thread. Instance: None, Running: N/A
2025-04-28 20:34:02,658 - ccbp.core.crop_controller - DEBUG - crop_controller:411 - --- cleanup_workers finished. Returning: True ---
2025-04-28 20:34:02,661 - ccbp.core.crop_worker - DEBUG - crop_worker:43 - PreviewWorker initialized with input: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput, ffmpeg: /opt/homebrew/bin/ffmpeg, ffprobe: /opt/homebrew/bin/ffprobe, params: {'w': 1080, 'h': 1920, 'x': 'center', 'y': 'center'}
2025-04-28 20:34:02,661 - ccbp.core.crop_controller - DEBUG - crop_controller:146 - Connecting PreviewWorker signals...
2025-04-28 20:34:02,662 - ccbp.core.crop_controller - INFO - crop_controller:157 - Starting PreviewWorker thread execution.
2025-04-28 20:34:02,663 - ccbp.core.crop_worker - INFO - crop_worker:48 - Preview generation started.
2025-04-28 20:34:02,665 - ccbp.core.crop_worker - INFO - crop_worker:59 - Searching for video files in: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput
2025-04-28 20:34:02,666 - ccbp.core.crop_worker - INFO - crop_worker:67 - Video file found for preview: Project_00002.mov
2025-04-28 20:34:02,666 - ccbp.core.crop_worker - INFO - crop_worker:75 - Calculating crop coordinates for preview...
2025-04-28 20:34:02,666 - ccbp.core.crop_worker - DEBUG - crop_worker:213 - Running ffprobe for dimensions: /opt/homebrew/bin/ffprobe -v error -select_streams v:0 -show_entries stream=width,height -of csv=p=0:s=x /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00002.mov
2025-04-28 20:34:02,687 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: プレビュー生成を開始します...
2025-04-28 20:34:02,688 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: 入力フォルダを検索中...
2025-04-28 20:34:02,688 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: フォルダ内の動画ファイルを検索: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput
2025-04-28 20:34:02,689 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 動画ファイル発見: Project_00002.mov
2025-04-28 20:34:02,689 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: クロップ座標を計算中...
2025-04-28 20:34:03,041 - ccbp.core.crop_worker - DEBUG - crop_worker:218 - ffprobe dimension output: '1080x2338'
2025-04-28 20:34:03,042 - ccbp.core.crop_worker - INFO - crop_worker:223 - Video dimensions for Project_00002.mov: 1080x2338
2025-04-28 20:34:03,042 - ccbp.core.crop_worker - INFO - crop_worker:82 - Calculated crop for preview: W=1080, H=1920, X=0, Y=209
2025-04-28 20:34:03,042 - ccbp.core.crop_worker - INFO - crop_worker:86 - Extracting cropped frame from 'Project_00002.mov'...
2025-04-28 20:34:03,044 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 計算されたクロップ座標: W=1080, H=1920, X=0, Y=209
2025-04-28 20:34:03,044 - ccbp.core.crop_worker - DEBUG - crop_worker:92 - Temporary file created: /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,044 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: 'Project_00002.mov' からクロップしてフレームを抽出中...
2025-04-28 20:34:03,044 - ccbp.core.crop_worker - INFO - crop_worker:108 - Running FFmpeg command: /opt/homebrew/bin/ffmpeg -ss 1 -i /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00002.mov -vf crop=1080:1920:0:209 -vframes 1 -f image2 -q:v 2 -y /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,053 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 一時ファイルを作成: /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,054 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: FFmpegコマンド実行: /opt/homebrew/bin/ffmpeg -ss 1 -i /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00002.mov -vf crop=1080:1920:0:209 -vframes 1 -f image2 -q:v 2 -y /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,206 - ccbp.core.crop_worker - INFO - crop_worker:128 - FFmpeg frame extraction successful in 0.16s.
2025-04-28 20:34:03,206 - ccbp.core.crop_worker - INFO - crop_worker:131 - Loading image from temporary file: /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,207 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 一時画像ファイルを読み込み中...
2025-04-28 20:34:03,224 - ccbp.core.crop_worker - INFO - crop_worker:154 - Preview image loaded successfully.
2025-04-28 20:34:03,225 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: プレビュー生成完了
2025-04-28 20:34:03,225 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: プレビュー画像の生成が完了しました。
2025-04-28 20:34:03,226 - ccbp.core.crop_worker - DEBUG - crop_worker:187 - Temporary file removed: /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,226 - ccbp.core.crop_controller - INFO - crop_controller:295 - PreviewWorker finished signal received. Success: True
2025-04-28 20:34:03,226 - ccbp.core.crop_worker - INFO - crop_worker:192 - Preview generation finished.
2025-04-28 20:34:03,233 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 一時ファイルを削除: /var/folders/x7/tq0swxf56wd1n9jbtnm25cc80000gn/T/tmp6f9gltzq.jpg
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:415 - --- _check_and_reset_ui called ---
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:417 - Attempting to reset crop UI elements.
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:421 - Crop UI elements reset.
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:425 - Checking if crop alert needs to be shown. _last_crop_result: None
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:446 - No crop result stored, skipping alert.
2025-04-28 20:34:03,234 - ccbp.core.crop_controller - DEBUG - crop_controller:698 - Clearing preview worker references.
2025-04-28 20:34:09,503 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/csv_file': /Users/mbp/Movies/CapCut/sample_batch_sheet.csv}
2025-04-28 20:34:09,504 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:09,504 - ccbp.core.batch_controller - INFO - batch_controller:155 - CSV file selected and saved: /Users/mbp/Movies/CapCut/sample_batch_sheet.csv
2025-04-28 20:34:24,851 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/template_dir': /Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft/TemplateA}
2025-04-28 20:34:24,851 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:24,852 - ccbp.core.batch_controller - INFO - batch_controller:167 - Template folder selected and saved: /Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft/TemplateA
2025-04-28 20:34:41,014 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/template_material_dir': /Users/mbp/Movies/CapCut/CCBP_WorkSpace/TemplateMaterial}
2025-04-28 20:34:41,014 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:41,015 - ccbp.core.batch_controller - INFO - batch_controller:179 - Template material folder selected and saved: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/TemplateMaterial
2025-04-28 20:34:44,565 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/replace_material_dir': /Users/mbp/Movies/CapCut/CCBP_WorkSpace/ChangeMaterial}
2025-04-28 20:34:44,566 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:44,566 - ccbp.core.batch_controller - INFO - batch_controller:191 - Replace material folder selected and saved: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/ChangeMaterial
2025-04-28 20:34:53,184 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/output_dir': /Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft}
2025-04-28 20:34:53,185 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:53,185 - ccbp.core.batch_controller - INFO - batch_controller:203 - Output folder selected and saved: /Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft
2025-04-28 20:34:58,978 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'batch/output_csv_dir': /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CsvOutput}
2025-04-28 20:34:58,979 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:34:58,979 - ccbp.core.batch_controller - INFO - batch_controller:215 - Output CSV folder selected and saved: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CsvOutput
2025-04-28 20:35:02,653 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:60 - API Key added to request headers.
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:65 - Sending license validation request:
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:66 -   URL: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:67 -   Method: GET
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:68 -   Headers: {'Authorization': 'Bearer CbVn7P73enT9ZqZDM42MKRrDqQgUDZX3T3YkySZ4zgihHRYYXQxEtExxTtkC3qEgqyR7Ah23jreA4DhiJTT4cnAooG6ewFfYoXrHYq47EzbvK2mvmKNT8jx4KDqCNxwK'}
2025-04-28 20:35:02,654 - ccbp.core.license_manager - DEBUG - license_manager:69 -   Params: {'action': 'verify', 'key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB'}
2025-04-28 20:35:07,186 - ccbp.core.license_manager - DEBUG - license_manager:71 - API Response Status Code: 200
2025-04-28 20:35:07,186 - ccbp.core.license_manager - DEBUG - license_manager:72 - API Response Headers: {'Content-Type': 'application/json; charset=utf-8', 'Vary': 'Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site', 'X-Content-Type-Options': 'nosniff', 'Access-Control-Allow-Origin': '*', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': 'Mon, 01 Jan 1990 00:00:00 GMT', 'Date': 'Mon, 28 Apr 2025 11:35:06 GMT', 'Content-Encoding': 'gzip', 'X-Frame-Options': 'SAMEORIGIN', 'Content-Security-Policy': "frame-ancestors 'self'", 'X-XSS-Protection': '1; mode=block', 'Server': 'GSE', 'Alt-Svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000', 'Transfer-Encoding': 'chunked'}
2025-04-28 20:35:07,187 - ccbp.core.license_manager - DEBUG - license_manager:77 - API Response Body: {'license_key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB', 'expires': '0000-00-00', 'persistent_signature': 'feAs77FEmOF+IB3D0qAr0ACO6OGeudL0TUB2HodIsZo=', 'created_at': '2025-04-18 17:13:22', 'checked_at': '2025-04-28 20:35:03', 'status': 'active', 'response_timestamp': '2025-04-28T11:35:03.585Z', 'response_signature': '8680e94e6fc1b6bbcd1384e90651867c870211edc6ef3a37d76cec6203f826bd'}
2025-04-28 20:35:07,187 - ccbp.core.config_manager - DEBUG - config_manager:291 - Encrypted value set for key 'license_key'
2025-04-28 20:35:07,187 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.status': active}
2025-04-28 20:35:07,187 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.expires': 0000-00-00}
2025-04-28 20:35:07,187 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.validated_at': 2025-04-28T11:35:07.187327+00:00}
2025-04-28 20:35:07,187 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.last_message': 有効 (無期限ライセンス)}
2025-04-28 20:35:07,188 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:35:07,188 - ccbp.core.license_manager - INFO - license_manager:155 - License cache updated: Key=WG54d..., Status=active, Expires=0000-00-00, ValidatedAt=2025-04-28T11:35:07.187327+00:00, Message=有効 (無期限ライセンス)
2025-04-28 20:35:07,189 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:35:07,189 - ccbp.core.batch_controller - INFO - batch_controller:251 - Run batch processing requested with paths: {'csv_path': '/Users/mbp/Movies/CapCut/sample_batch_sheet.csv', 'template_project_path': '/Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft/TemplateA', 'template_material_base': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/TemplateMaterial', 'change_material_base': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/ChangeMaterial', 'output_projects_dir': '/Users/mbp/Movies/CapCut/User Data/Projects/com.lveditor.draft', 'output_csv_dir': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/CsvOutput'}
2025-04-28 20:35:07,189 - ccbp.core.batch_controller - ERROR - batch_controller:529 - Path validation failed:
エラー: csv ファイルのパスが指定されていません。
エラー: template フォルダのパスが指定されていません。
エラー: template_material フォルダのパスが指定されていません。
エラー: output フォルダのパスが指定されていません。
エラー: output_csv フォルダのパスが指定されていません。
2025-04-28 20:35:17,300 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:60 - API Key added to request headers.
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:65 - Sending license validation request:
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:66 -   URL: https://script.google.com/macros/s/AKfycbx_dKGuaYsMhK1KhdtG1QMUH2lVApPrwxmF0oWMEI2tUussEAaNBhqYp-M32YjE-elm7g/exec
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:67 -   Method: GET
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:68 -   Headers: {'Authorization': 'Bearer CbVn7P73enT9ZqZDM42MKRrDqQgUDZX3T3YkySZ4zgihHRYYXQxEtExxTtkC3qEgqyR7Ah23jreA4DhiJTT4cnAooG6ewFfYoXrHYq47EzbvK2mvmKNT8jx4KDqCNxwK'}
2025-04-28 20:35:17,301 - ccbp.core.license_manager - DEBUG - license_manager:69 -   Params: {'action': 'verify', 'key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB'}
2025-04-28 20:35:21,260 - ccbp.core.license_manager - DEBUG - license_manager:71 - API Response Status Code: 200
2025-04-28 20:35:21,260 - ccbp.core.license_manager - DEBUG - license_manager:72 - API Response Headers: {'Content-Type': 'application/json; charset=utf-8', 'Vary': 'Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site', 'X-Content-Type-Options': 'nosniff', 'Access-Control-Allow-Origin': '*', 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate', 'Pragma': 'no-cache', 'Expires': 'Mon, 01 Jan 1990 00:00:00 GMT', 'Date': 'Mon, 28 Apr 2025 11:35:21 GMT', 'Content-Encoding': 'gzip', 'X-Frame-Options': 'SAMEORIGIN', 'Content-Security-Policy': "frame-ancestors 'self'", 'X-XSS-Protection': '1; mode=block', 'Server': 'GSE', 'Alt-Svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000', 'Transfer-Encoding': 'chunked'}
2025-04-28 20:35:21,260 - ccbp.core.license_manager - DEBUG - license_manager:77 - API Response Body: {'license_key': 'WG54dL-oI65Cv-g8wHNI-DP3uBB', 'expires': '0000-00-00', 'persistent_signature': 'feAs77FEmOF+IB3D0qAr0ACO6OGeudL0TUB2HodIsZo=', 'created_at': '2025-04-18 17:13:22', 'checked_at': '2025-04-28 20:35:18', 'status': 'active', 'response_timestamp': '2025-04-28T11:35:18.331Z', 'response_signature': '4f3b9a0dd21d0346975fb7bcec14031ccb0c825684d339fe71d1594b9e100fa4'}
2025-04-28 20:35:21,260 - ccbp.core.config_manager - DEBUG - config_manager:291 - Encrypted value set for key 'license_key'
2025-04-28 20:35:21,261 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.status': active}
2025-04-28 20:35:21,261 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.expires': 0000-00-00}
2025-04-28 20:35:21,261 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.validated_at': 2025-04-28T11:35:21.260699+00:00}
2025-04-28 20:35:21,261 - ccbp.core.config_manager - DEBUG - config_manager:299 - Config set (plaintext): {'license.last_message': 有効 (無期限ライセンス)}
2025-04-28 20:35:21,262 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:35:21,262 - ccbp.core.license_manager - INFO - license_manager:155 - License cache updated: Key=WG54d..., Status=active, Expires=0000-00-00, ValidatedAt=2025-04-28T11:35:21.260699+00:00, Message=有効 (無期限ライセンス)
2025-04-28 20:35:21,262 - ccbp.core.config_manager - DEBUG - config_manager:258 - Decrypted value for key 'license_key'
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - INFO - crop_controller:178 - Run cropping requested (using fixed 1080x1920 center crop).
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:179 - Checking view...
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:183 - Checking ffmpeg path...
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:189 - Checking running preview thread: None
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:195 - Checking running crop thread: None
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:202 - Getting paths from view...
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - INFO - crop_controller:206 - Run cropping paths: {'input': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput', 'output': '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput'}, params: {'w': 1080, 'h': 1920, 'x': 'center', 'y': 'center'} (Fixed)
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:208 - Validating crop paths...
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:453 - Validating input path string: '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput'
2025-04-28 20:35:21,263 - ccbp.core.crop_controller - DEBUG - crop_controller:473 - Validating output path string: '/Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput'
2025-04-28 20:35:21,264 - ccbp.core.crop_controller - DEBUG - crop_controller:513 - _validate_crop_paths result: True
2025-04-28 20:35:21,264 - ccbp.core.crop_controller - DEBUG - crop_controller:220 - Setting UI state for crop processing.
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - INFO - crop_controller:226 - Preparing CropWorker thread.
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:227 - Calling cleanup_workers before starting CropWorker...
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:340 - --- cleanup_workers requested ---
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:343 - Checking preview thread. Instance: None, Running: N/A
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:377 - Checking crop thread. Instance: None, Running: N/A
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:411 - --- cleanup_workers finished. Returning: True ---
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:229 - cleanup_workers result: True
2025-04-28 20:35:21,278 - ccbp.core.crop_controller - DEBUG - crop_controller:235 - Cleanup successful, proceeding to create CropWorker thread.
2025-04-28 20:35:21,278 - ccbp.core.crop_worker - DEBUG - crop_worker:295 - CropWorker initialized with params: {'w': 1080, 'h': 1920, 'x': 'center', 'y': 'center'}
2025-04-28 20:35:21,279 - ccbp.core.crop_controller - DEBUG - crop_controller:261 - Connecting CropWorker signals...
2025-04-28 20:35:21,279 - ccbp.core.crop_controller - INFO - crop_controller:273 - Starting CropWorker thread execution.
2025-04-28 20:35:21,279 - ccbp.core.crop_worker - INFO - crop_worker:299 - Crop processing started.
2025-04-28 20:35:21,279 - ccbp.core.crop_worker - INFO - crop_worker:308 - Searching for input videos in: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput
2025-04-28 20:35:21,279 - ccbp.core.crop_worker - INFO - crop_worker:332 - Found 5 video files to process.
2025-04-28 20:35:21,279 - ccbp.core.crop_worker - INFO - crop_worker:346 - --- Processing video 1/5: Project_00002.mov -> Project_00002_cropped.mp4 ---
2025-04-28 20:35:21,279 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: クロップ処理を開始します... (FFmpeg: /opt/homebrew/bin/ffmpeg)
2025-04-28 20:35:21,280 - ccbp.core.crop_worker - DEBUG - crop_worker:357 - Centering required for Project_00002.mov. Getting video dimensions...
2025-04-28 20:35:21,280 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 入力フォルダを検索: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput
2025-04-28 20:35:21,280 - ccbp.core.crop_worker - DEBUG - crop_worker:546 - Found ffprobe next to ffmpeg: /opt/homebrew/bin/ffprobe
2025-04-28 20:35:21,280 - ccbp.core.crop_worker - DEBUG - crop_worker:567 - Running ffprobe command: /opt/homebrew/bin/ffprobe -v error -select_streams v:0 -show_entries stream=width,height -of json /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00002.mov
2025-04-28 20:35:21,291 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 5 件の動画ファイルを処理します。
2025-04-28 20:35:21,293 - ccbp.core.crop_controller - DEBUG - crop_controller:329 - Worker Progress Update: 0%
2025-04-28 20:35:21,293 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: 動画 1/5: Project_00002.mov を処理中...
2025-04-28 20:35:21,293 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: --- 動画 1: Project_00002.mov --- 開始 --- (Project_00002_cropped.mp4)
2025-04-28 20:35:21,463 - ccbp.core.crop_worker - DEBUG - crop_worker:584 - Dimensions for Project_00002.mov: 1080x2338
2025-04-28 20:35:21,463 - ccbp.core.crop_worker - INFO - crop_worker:374 - Calculated center crop for Project_00002.mov: W=1080, H=1920, X=0, Y=209
2025-04-28 20:35:21,463 - ccbp.core.crop_worker - INFO - crop_worker:404 - Running FFmpeg command: /opt/homebrew/bin/ffmpeg -i /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00002.mov -y -vf crop=1080:1920:0:209 -c:v libx264 -crf 23 -preset fast -c:a aac -b:a 128k /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput/Project_00002_cropped.mp4
2025-04-28 20:35:21,463 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [1/5] FFmpeg 実行中: Project_00002.mov -> Project_00002_cropped.mp4
2025-04-28 20:35:41,016 - ccbp.core.crop_worker - INFO - crop_worker:428 - Video 1 processed successfully in 19.55s: Project_00002_cropped.mp4
2025-04-28 20:35:41,017 - ccbp.core.crop_worker - INFO - crop_worker:469 - --- Finished video 1/5: Project_00002.mov --- Result: 成功 ---
2025-04-28 20:35:41,017 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [1/5] 成功 (19.55秒): Project_00002_cropped.mp4
2025-04-28 20:35:41,019 - ccbp.core.crop_controller - DEBUG - crop_controller:329 - Worker Progress Update: 20%
2025-04-28 20:35:41,025 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [1/5] 完了 (成功): Project_00002.mov
2025-04-28 20:35:41,072 - ccbp.core.crop_worker - INFO - crop_worker:346 - --- Processing video 2/5: Project_00003.mov -> Project_00003_cropped.mp4 ---
2025-04-28 20:35:41,072 - ccbp.core.crop_worker - DEBUG - crop_worker:357 - Centering required for Project_00003.mov. Getting video dimensions...
2025-04-28 20:35:41,073 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: 動画 2/5: Project_00003.mov を処理中...
2025-04-28 20:35:41,073 - ccbp.core.crop_worker - DEBUG - crop_worker:546 - Found ffprobe next to ffmpeg: /opt/homebrew/bin/ffprobe
2025-04-28 20:35:41,073 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: --- 動画 2: Project_00003.mov --- 開始 --- (Project_00003_cropped.mp4)
2025-04-28 20:35:41,073 - ccbp.core.crop_worker - DEBUG - crop_worker:567 - Running ffprobe command: /opt/homebrew/bin/ffprobe -v error -select_streams v:0 -show_entries stream=width,height -of json /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00003.mov
2025-04-28 20:35:41,167 - ccbp.core.crop_worker - DEBUG - crop_worker:584 - Dimensions for Project_00003.mov: 1080x2338
2025-04-28 20:35:41,167 - ccbp.core.crop_worker - INFO - crop_worker:374 - Calculated center crop for Project_00003.mov: W=1080, H=1920, X=0, Y=209
2025-04-28 20:35:41,167 - ccbp.core.crop_worker - INFO - crop_worker:404 - Running FFmpeg command: /opt/homebrew/bin/ffmpeg -i /Users/mbp/Movies/CapCut/CCBP_WorkSpace/VideoOutput/Project_00003.mov -y -vf crop=1080:1920:0:209 -c:v libx264 -crf 23 -preset fast -c:a aac -b:a 128k /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput/Project_00003_cropped.mp4
2025-04-28 20:35:41,167 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [2/5] FFmpeg 実行中: Project_00003.mov -> Project_00003_cropped.mp4
2025-04-28 20:35:44,046 - ccbp.core.crop_controller - INFO - crop_controller:277 - Cancel processing requested by user.
2025-04-28 20:35:44,046 - ccbp.core.crop_controller - INFO - crop_controller:285 - Requesting cancellation of CropWorker.
2025-04-28 20:35:44,046 - ccbp.core.crop_worker - INFO - crop_worker:521 - CropWorker cancel requested.
2025-04-28 20:35:44,046 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: クロップ処理のキャンセル要求を受信しました。
2025-04-28 20:35:45,049 - ccbp.core.crop_controller - INFO - crop_controller:277 - Cancel processing requested by user.
2025-04-28 20:35:45,050 - ccbp.core.crop_controller - INFO - crop_controller:285 - Requesting cancellation of CropWorker.
2025-04-28 20:35:45,050 - ccbp.core.crop_worker - INFO - crop_worker:521 - CropWorker cancel requested.
2025-04-28 20:35:45,050 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: クロップ処理のキャンセル要求を受信しました。
2025-04-28 20:35:59,138 - ccbp.core.crop_worker - WARNING - crop_worker:416 - Cancellation detected after ffmpeg finished for Project_00003.mov. Cleaning up.
2025-04-28 20:35:59,139 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [2/5] 処理中にキャンセル: Project_00003.mov
2025-04-28 20:35:59,140 - ccbp.core.crop_worker - DEBUG - crop_worker:421 - Removed partial output file: /Users/mbp/Movies/CapCut/CCBP_WorkSpace/CropOutput/Project_00003_cropped.mp4
2025-04-28 20:35:59,141 - ccbp.core.crop_worker - INFO - crop_worker:469 - --- Finished video 2/5: Project_00003.mov --- Result: 失敗 ---
2025-04-28 20:35:59,145 - ccbp.core.crop_controller - DEBUG - crop_controller:329 - Worker Progress Update: 40%
2025-04-28 20:35:59,150 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: [2/5] 完了 (失敗): Project_00003.mov
2025-04-28 20:35:59,195 - ccbp.core.crop_worker - INFO - crop_worker:486 - 処理はキャンセルされました。完了: 1, 失敗: 0 (残り 3 件未処理)。
2025-04-28 20:35:59,195 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: --- 処理結果 (キャンセル) ---
2025-04-28 20:35:59,196 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 完了済み (成功): 1 件
2025-04-28 20:35:59,196 - ccbp.core.crop_worker - INFO - crop_worker:517 - Crop processing run method finished.
2025-04-28 20:35:59,196 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 完了済み (失敗): 0 件
2025-04-28 20:35:59,197 - ccbp.core.crop_controller - DEBUG - crop_controller:335 - Appending message to UI log: 未処理: 3 件
2025-04-28 20:35:59,197 - ccbp.core.crop_controller - DEBUG - crop_controller:323 - Worker Status Update: キャンセル済
2025-04-28 20:35:59,200 - ccbp.core.crop_controller - INFO - crop_controller:308 - CropWorker finished signal received. Overall Success: False, Success Count: 1, Error Count: 0
2025-04-28 20:35:59,200 - ccbp.core.crop_controller - DEBUG - crop_controller:309 - Storing crop result: Success=False, Count=1, Errors=0
2025-04-28 20:35:59,200 - ccbp.core.crop_controller - DEBUG - crop_controller:311 - Stored _last_crop_result: (False, 1, 0)
2025-04-28 20:35:59,200 - ccbp.core.crop_controller - DEBUG - crop_controller:415 - --- _check_and_reset_ui called ---
2025-04-28 20:35:59,201 - ccbp.core.crop_controller - DEBUG - crop_controller:417 - Attempting to reset crop UI elements.
2025-04-28 20:35:59,205 - ccbp.core.crop_controller - DEBUG - crop_controller:421 - Crop UI elements reset.
2025-04-28 20:35:59,205 - ccbp.core.crop_controller - DEBUG - crop_controller:425 - Checking if crop alert needs to be shown. _last_crop_result: (False, 1, 0)
2025-04-28 20:35:59,205 - ccbp.core.crop_controller - DEBUG - crop_controller:427 - Proceeding to show crop completion alert.
2025-04-28 20:35:59,205 - ccbp.core.crop_controller - DEBUG - crop_controller:430 - View exists, attempting to show QMessageBox for crop.
2025-04-28 20:35:59,205 - ccbp.core.crop_controller - DEBUG - crop_controller:437 - Showing crop warning alert: クロップ処理中にエラーが発生しました。
成功: 1件, 失敗: 0件
詳細はログを確認してください。
2025-04-28 20:35:59,276 - ccbp.core.crop_controller - DEBUG - crop_controller:704 - Clearing crop worker references.
2025-04-28 20:36:01,014 - ccbp.core.crop_controller - DEBUG - crop_controller:439 - Finished showing QMessageBox for crop.
2025-04-28 20:36:01,014 - ccbp.core.crop_controller - DEBUG - crop_controller:444 - Cleared _last_crop_result.
2025-04-28 20:36:04,454 - ccbp.core.settings_controller - INFO - settings_controller:584 - Finalizing SettingsController.
2025-04-28 20:36:04,454 - ccbp.core.settings_controller - DEBUG - settings_controller:525 - No existing license worker/thread to clean up.
2025-04-28 20:36:04,454 - ccbp.core.settings_controller - INFO - settings_controller:594 - SettingsController finalized
2025-04-28 20:36:04,468 - ccbp - INFO - main:151 - Application exiting. Saving configuration...
2025-04-28 20:36:04,468 - ccbp.core.config_manager - INFO - config_manager:235 - Configuration saved to /Users/mbp/Library/Application Support/CCBP/config.json
2025-04-28 20:36:04,468 - ccbp - INFO - main:156 - Configuration saved.


---

_**Assistant**_



---

# 実行結果報告

## 概要
提供されたログファイルを分析し、アプリケーション `CCBP` の起動シーケンス、主要機能の動作（設定管理、ライセンス認証、バッチ処理、クロップ処理）、および発生した警告・エラーを確認しました。全体としてアプリケーションは動作していますが、いくつかの改善点と注意すべき点が特定されました。

## 実行ステップと分析結果

1.  **ログ全体の確認と主要処理の把握:**
    *   複数回の起動ログを確認し、設定ファイルの読み込み/生成、ライセンス認証、バッチ処理設定、クロッププレビュー生成、クロップ処理実行（とキャンセル）といった一連の動作フローを追跡しました。
    *   初回起動時には設定ファイルと暗号化キーが自動生成され、インストール日が記録されることが確認されました。
    *   ライセンス認証は非同期で行われ、API 経由で正常に検証され、結果がキャッシュされている様子が確認できました。
    *   クロップ処理では、`ffmpeg`/`ffprobe` を使用した動画情報の取得、座標計算、フレーム抽出、非同期実行、進捗更新、キャンセル処理が実装されていることがログから読み取れました。
2.  **WARNING/ERROR ログの分析:**
    *   **`ffmpeg`/`ffprobe` のパス解決:** アプリケーション同梱の `assets/ffmpeg` 内にツールが見つからず、システムの PATH から利用している旨の警告 (`WARNING - crop_controller:642`, `WARNING - crop_controller:651`) が記録されています。これは配布時に問題となる可能性があります。
    *   **暗号化キー `license_key` の値:** ライセンスキー未入力時に設定ファイルを読み込もうとすると、値が空文字列であるため復号できずデフォルト値を返す旨の警告 (`WARNING - config_manager:251`) が出ていますが、これは想定内の動作と考えられます。
    *   **バッチ処理 CSV パスの空保存:** 空のパスを保存しようとした際に処理を中断する警告 (`WARNING - batch_controller:584`) が出ており、これは意図しない空設定を防ぐガードとして機能しています。
    *   **バッチ処理パス検証エラー:** バッチ処理実行試行時に、設定されたパスの検証に失敗するエラー (`ERROR - batch_controller:529`) が発生しています。ログにはパスが渡されているように見えますが、エラーメッセージは「指定されていません」となっており、検証ロジックまたはエラーメッセージに問題がある可能性が考えられます。
    *   **クロップ処理キャンセル:** クロップ処理中にキャンセルが要求され、`ffmpeg` 実行完了後にキャンセル処理が実行され、部分的に生成されたファイルが削除される警告 (`WARNING - crop_worker:416`) が記録されています。キャンセル処理自体は機能しているようです。
3.  **INFO/DEBUG ログからの補足:**
    *   DEBUG ログが非常に詳細であり、Fernet キー処理、API 通信、Worker の動作、UI 更新連携などの内部動作のトレースに役立ちます。
4.  **注目点の整理:**
    *   `ffmpeg`/`ffprobe` の環境依存性。
    *   バッチ処理実行前のパス検証ロジックの不確実性。
    *   設定変更時の頻繁なファイル保存。
    *   詳細すぎる DEBUG ログ（リリース時の考慮事項）。
    *   キャンセル処理のタイミング。

## 最終成果物
この分析結果報告書が最終成果物です。

## 課題対応（該当する場合）
上記の「WARNING/ERROR ログの分析」および「注目点の整理」に記載の通りです。

## 注意点・改善提案

1.  **`ffmpeg`/`ffprobe` の同梱とパス解決:**
    *   **推奨:** アプリケーション配布時には、サポートするプラットフォーム用の `ffmpeg` および `ffprobe` を `assets` ディレクトリ等に同梱し、アプリケーションが確実にその同梱版を利用できるようにパス解決ロジック (`CropController._find_ffmpeg_paths`?) を見直してください。特に PyInstaller や Nuitka などでバンドルする場合は、`sys._MEIPASS` などを考慮する必要があります。
    *   **代替案:** 同梱が難しい場合、初回起動時や設定画面でユーザーに `ffmpeg`/`ffprobe` のパスを手動で設定させる機能を追加することを検討してください。
2.  **バッチ処理のパス検証ロジック:**
    *   **推奨:** `BatchController._validate_batch_paths` (または相当するメソッド) をデバッグし、パスが存在するか、期待される種類（ファイル/ディレクトリ）か、必要なパーミッションがあるかなどを正確に検証できるように修正してください。
    *   **推奨:** 検証エラー発生時には、どのパスでどのような問題が発生したのか（例：「ファイルが見つかりません: /path/to/file.csv」、「ディレクトリに書き込めません: /path/to/output」）を具体的にログおよび UI に表示するように改善してください。
3.  **設定保存のタイミング:**
    *   **検討:** 特にパス設定など、変更頻度が低い可能性のある項目については、UI 操作のたびに自動保存するのではなく、ユーザーが明示的に「保存」ボタンを押したタイミングで `config.json` に書き込む方式を検討してください。これによりディスク I/O を削減できます。
4.  **ログレベル管理:**
    *   **推奨:** リリース版ではデフォルトのログレベルを `INFO` に設定し、デバッグが必要な場合にのみユーザーが設定変更や起動オプションで `DEBUG` レベルに変更できるようにすることを推奨します。
5.  **UI フィードバック:**
    *   **推奨:** バッチ処理の必須パスが空のまま実行しようとした場合や、設定保存に失敗した場合など、ログだけでなく UI 上でもユーザーにわかりやすいフィードバック（メッセージボックス等）を表示するように改善してください。

---

